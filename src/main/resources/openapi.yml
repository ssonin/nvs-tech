openapi: 3.1.0
info:
  title: nvs-tech API
  version: 1.0.0

paths:

  /api/v1/clients:
    post:
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [first_name, last_name, email]
              properties:
                first_name:
                  type: string
                last_name:
                  type: string
                email:
                  type: string
                  format: email
                description:
                  type: string
      responses:
        "201":
          description: Client created successfully
          headers:
            Location:
              schema:
                type: string
                format: uri
              description: URI of the created client resource
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Client"
        "409":
          description: Email is already in use

  /api/v1/clients/{id}:
    get:
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Client retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Client"
        "404":
          description: Client not found

  /api/v1/clients/{id}/documents:
    post:
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, content]
              properties:
                title:
                  type: string
                content:
                  type: string
      responses:
        "201":
          description: Document created successfully
          headers:
            Location:
              schema:
                type: string
                format: uri
              description: URI of the created document resource
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Document"
        "404":
          description: Client not found

  /api/v1/search:
    get:
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query to match against client and document fields
      responses:
        "200":
          description: Search results containing clients and documents sorted by rank in descending order
          content:
            application/json:
              schema:
                type: array
                items:
                  oneOf:
                    - $ref: "#/components/schemas/ClientSearchResult"
                    - $ref: "#/components/schemas/DocumentSearchResult"

components:
  schemas:
    Client:
      type: object
      required: [id, created_at, first_name, last_name, email]
      properties:
        id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
          format: email
        description:
          type: string

    Document:
      type: object
      required: [id, created_at, client_id, title, content]
      properties:
        id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        client_id:
          type: string
          format: uuid
        title:
          type: string
        content:
          type: string

    ClientSearchResult:
      allOf:
        - $ref: "#/components/schemas/Client"
        - type: object
          required: [type, rank]
          properties:
            type:
              type: string
              enum: [client]
            rank:
              type: number
              format: double
              description: Relevance score indicating how well the client matches the search query

    DocumentSearchResult:
      allOf:
        - $ref: "#/components/schemas/Document"
        - type: object
          required: [type, rank]
          properties:
            type:
              type: string
              enum: [document]
            rank:
              type: number
              format: double
              description: Relevance score indicating how well the document matches the search query
